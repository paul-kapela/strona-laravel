"use strict";function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(n,!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}window.mathquill4quill=function(t){var E=(t=t||{}).Quill||window.Quill,j=t.MathQuill||window.MathQuill,_=t.katex||window.katex,C=t.localStorage||window.localStorage;function P(t){try{return C.getItem(t)}catch(t){return""}}return function(o,t){function l(){return o.container.getElementsByClassName("ql-tooltip")[0]}function n(){return l().getElementsByTagName("input")[0]}if(t=t||{},E?j?_?o.options.modules.formula?MutationObserver||(console.log("MutationObserver not defined"),0):(console.log("Formula module not enabled"),0):(console.log("katex.js not loaded"),0):(console.log("MathQuill.js not loaded"),0):(console.log("Quill.js not loaded"),0)){var r,i,u,a,c,s,e,d,f,m,h=l(),p=t.historyCacheKey||"__mathquill4quill_historylist_cache__",y=function(t){try{return JSON.parse(C.getItem(t))||[]}catch(t){return[]}}(p),b=t.historySize||10,v=t.displayHistory||!1,g=(r=null==t.autofocus||t.autofocus,i=null!=t.mathQuillConfig?t.mathQuillConfig:{},u=t.cacheKey||"__mathquill4quill_cache__",s=c=a=null,{render:function(){if(null==a){var t=n(),e=l().getElementsByClassName("ql-action")[0];return function(t){t.setAttribute("class","mathquill4quill-mathquill-input")}(a=document.createElement("span")),s=t.className,function(t){t.setAttribute("class","mathquill4quill-latex-input")}(t),function(t){r&&window.setTimeout(function(){return t.focus()},1)}(c=O(t,e)),function(t,e){e.parentNode.insertBefore(t,e.nextSibling)}(a,t),c}},destroy:function(){null!=a&&(n().setAttribute("class",s),a.remove(),a=null)}}),w=(e=t.operators||[],d=null,{render:function(n){if(null==d&&0!==e.length){var t=l();(function(t){t.setAttribute("class","mathquill4quill-operator-container")})(d=document.createElement("div")),e.forEach(function(t){var e=function(t,e){var n=t[0],r=t[1],o=document.createElement("button");return o.setAttribute("type","button"),_.render(n,o,{throwOnError:!1}),o.onclick=function(){e.cmd(r),e.focus()},o}(t,n);!function(t){t.setAttribute("class","mathquill4quill-operator-button")}(e),d.appendChild(e)}),t.appendChild(d)}},destroy:function(){null!=d&&(d.remove(),d=null)}}),q=(f=y||[],m=null,{render:function(n){if(function(){var t=l();t.getBoundingClientRect().top-o.container.getBoundingClientRect().top<0&&(t.style.top="0px")}(),null==m&&v&&0!==f.length){var t=l();m=document.createElement("div");var r=document.createElement("div");!function(t){t.setAttribute("class","mathquill4quill-history-container")}(r);var e=document.createElement("p");e.innerHTML="Past formulas (max "+b+")",m.appendChild(e),f.forEach(function(t){var e=function(t,e){var n=document.createElement("button");return n.setAttribute("type","button"),_.render(t,n,{throwOnError:!1}),n.onclick=function(){e.write(t),e.focus()},n}(t,n);!function(t){t.setAttribute("class","mathquill4quill-history-button")}(e),r.appendChild(e)}),m.appendChild(r),t.appendChild(m)}},destroy:function(){null!=m&&(m.remove(),m=null)}});new MutationObserver(function(){if(!h.classList.contains("ql-hidden")&&h.attributes["data-mode"]&&"formula"===h.attributes["data-mode"].value){var t=g.render();w.render(t),q.render(t)}else g.destroy(),w.destroy(),q.destroy()}).observe(h,{attributes:!0,attributeFilter:["class","data-mode"]})}function O(e,t){var n=null==i.handlers?{}:i.handlers;i.handlers=_objectSpread({},n,{edit:function(){var t=r.latex();e.value=t,function(t,e){try{C.setItem(t,e)}catch(t){}}(u,t)},enter:function(){t.click()}});var r=j.getInterface(2).MathField(a,i),o=P(u);return o&&r.latex(o),t.addEventListener("click",function(){!function(t){var e=P(t);if(e&&0<e.length){var n=y.indexOf(e);-1!=n&&y.splice(n,1),y.unshift(e),y.length>b&&y.pop();try{C.setItem(p,JSON.stringify(y))}catch(t){}}}(u),function(t){try{C.removeItem(t)}catch(t){}}(u)}),r}}},window.Quill&&(window.Quill.prototype.enableMathQuillFormulaAuthoring=function(t){window.mathquill4quill()(this,t)});
